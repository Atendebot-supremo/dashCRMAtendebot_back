â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    ğŸ“š GUIA DE INTEGRAÃ‡ÃƒO - LOGIN FRONTEND
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”— ENDPOINT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST /api/auth/login

URL Completa:
  â€¢ Desenvolvimento: http://localhost:3000/api/auth/login
  â€¢ ProduÃ§Ã£o: https://seu-backend.railway.app/api/auth/login


ğŸ“¤ REQUEST (O que enviar)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Headers:
  Content-Type: application/json

Body (JSON) - Pelo menos UM campo obrigatÃ³rio:
  {
    phone?: string,    // Opcional: 10-15 caracteres (ex: "31999999999")
    email?: string     // Opcional: email vÃ¡lido (ex: "[email protected]")
  }

Exemplos de Body:
  // Apenas telefone
  { "phone": "31999999999" }
  
  // Apenas email
  { "email": "[email protected]" }
  
  // Telefone E email (ambos opcionais)
  { "phone": "31999999999", "email": "[email protected]" }

ValidaÃ§Ãµes:
  â€¢ Telefone: 10-15 caracteres, apenas nÃºmeros e sÃ­mbolos vÃ¡lidos (+, -, (), espaÃ§os)
  â€¢ Email: formato vÃ¡lido
  â€¢ Pelo menos um campo (phone OU email) Ã© obrigatÃ³rio


âœ… RESPONSE DE SUCESSO (200)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",  // â† SALVAR NO LOCALSTORAGE
    "helena": {
      "accessToken": "pn_SjAWbv2gy8fBGvhBK780UEkE0fyp7oTfWLIAnwzI1k",
      "userId": "0fcbe461-b9dc-4731-be3a-0619cac93a10",
      "tenantId": "986ca29e-a041-46c2-b533-e08cd504439c"
    },
    "user": {
      "id": "uuid-do-usuario",
      "name": "Nome do UsuÃ¡rio",
      "phone": "5531999999999"
    }
  },
  "message": "Login realizado com sucesso"
}

âš ï¸ IMPORTANTE:
  â€¢ Salvar data.token no localStorage/sessionStorage/cookies
  â€¢ Usar esse token no header Authorization: Bearer ${token} em todas as 
    requisiÃ§Ãµes protegidas
  â€¢ O token expira em 8 horas


âŒ RESPONSES DE ERRO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

400 - Dados InvÃ¡lidos:
{
  "success": false,
  "error": "Dados invÃ¡lidos",
  "code": "INVALID_INPUT",
  "details": [
    {
      "field": "phone",
      "message": "Telefone deve ter entre 10 e 15 caracteres"
    }
  ]
}

401 - NÃ£o Autorizado:
{
  "success": false,
  "error": "Telefone/email nÃ£o encontrado ou inativo",
  "code": "UNAUTHORIZED"
}

429 - Rate Limit Excedido:
{
  "success": false,
  "error": "Muitas tentativas de login. Tente novamente mais tarde.",
  "code": "TOO_MANY_REQUESTS"
}

502 - Erro na API Helena:
{
  "success": false,
  "error": "Erro na autenticaÃ§Ã£o: ...",
  "code": "BAD_GATEWAY" | "SERVICE_UNAVAILABLE"
}


ğŸ’» CÃ“DIGO TYPESCRIPT DE EXEMPLO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// ========================================
// 1. TIPOS (criar arquivo types/auth.ts)
// ========================================
export interface LoginRequest {
  phone?: string
  email?: string
}

export interface LoginResponse {
  success: boolean
  data: {
    token: string
    helena: {
      accessToken: string
      userId: string
      tenantId: string
    }
    user: {
      id: string
      name: string
      phone: string
    }
  }
  message: string
}

export interface ApiError {
  success: false
  error: string
  code: string
  details?: Array<{ field: string; message: string }>
}

// ========================================
// 2. FUNÃ‡ÃƒO DE LOGIN (services/authService.ts)
// ========================================
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000'

export const login = async (phone?: string, email?: string): Promise<LoginResponse> => {
  // Validar que pelo menos um campo foi enviado
  if (!phone?.trim() && !email?.trim()) {
    throw new Error('Telefone ou email Ã© obrigatÃ³rio')
  }

  const response = await fetch(`${API_BASE_URL}/api/auth/login`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ phone, email })
  })

  const data = await response.json()

  if (!response.ok) {
    const error = data as ApiError
    throw new Error(error.error || 'Erro ao fazer login')
  }

  // Salvar token no localStorage
  if (data.success && data.data?.token) {
    localStorage.setItem('auth_token', data.data.token)
    localStorage.setItem('user_data', JSON.stringify(data.data.user))
  }

  return data as LoginResponse
}

// ========================================
// 3. FUNÃ‡ÃƒO PARA HEADERS AUTOMÃTICOS
// ========================================
export const getAuthHeaders = () => {
  const token = localStorage.getItem('auth_token')
  
  return {
    'Content-Type': 'application/json',
    ...(token && { 'Authorization': `Bearer ${token}` })
  }
}

// ========================================
// 4. EXEMPLO DE USO EM COMPONENTE
// ========================================
const handleLogin = async (phone: string) => {
  try {
    const response = await login(phone)
    console.log('Login realizado!', response.data.user)
    // Redirecionar ou atualizar estado
    router.push('/dashboard')
  } catch (error) {
    console.error('Erro no login:', error)
    // Mostrar mensagem de erro para o usuÃ¡rio
    alert(error.message)
  }
}

// ========================================
// 5. EXEMPLO DE REQUISIÃ‡ÃƒO PROTEGIDA
// ========================================
const fetchProtectedData = async () => {
  const token = localStorage.getItem('auth_token')
  
  if (!token) {
    // Redirecionar para login
    router.push('/login')
    return
  }

  const response = await fetch(`${API_BASE_URL}/api/crm/panels`, {
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    }
  })

  if (response.status === 401) {
    // Token expirado, fazer logout
    localStorage.removeItem('auth_token')
    router.push('/login')
    return
  }

  const data = await response.json()
  return data
}


âš ï¸ INFORMAÃ‡Ã•ES IMPORTANTES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. TOKEN JWT
   â€¢ Expira em 8 horas
   â€¢ Salvar no localStorage/sessionStorage/cookies
   â€¢ Usar em TODAS as requisiÃ§Ãµes protegidas
   â€¢ Header: Authorization: Bearer ${token}

2. RATE LIMITING
   â€¢ 10 tentativas por 15 minutos por IP
   â€¢ Mostrar mensagem amigÃ¡vel se exceder

3. HEADERS OBRIGATÃ“RIOS
   â€¢ Login: apenas Content-Type: application/json
   â€¢ Rotas protegidas: Authorization: Bearer ${token}

4. TRATAMENTO DE ERROS
   â€¢ 401: Token invÃ¡lido/expirado â†’ fazer logout e redirecionar para login
   â€¢ 429: Rate limit â†’ aguardar antes de tentar novamente
   â€¢ 502: Erro temporÃ¡rio â†’ tentar novamente

5. VARIÃVEIS DE AMBIENTE
   .env.local (Next.js) ou .env
   NEXT_PUBLIC_API_URL=http://localhost:3000           # Dev
   NEXT_PUBLIC_API_URL=https://seu-backend.railway.app # Prod


âœ… CHECKLIST DE IMPLEMENTAÃ‡ÃƒO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[ ] Criar funÃ§Ã£o de login que aceita phone e/ou email
[ ] Validar entrada (pelo menos um campo)
[ ] Salvar token no localStorage apÃ³s login bem-sucedido
[ ] Criar funÃ§Ã£o para adicionar header Authorization automaticamente
[ ] Tratar erros (400, 401, 429, 502)
[ ] Implementar logout (limpar token do localStorage)
[ ] Verificar token antes de fazer requisiÃ§Ãµes protegidas
[ ] Redirecionar para login se token expirar (401)
[ ] Adicionar interceptors/interceptors para adicionar token automaticamente
[ ] Criar contexto/state management para gerenciar autenticaÃ§Ã£o


ğŸ” AUTENTICAÃ‡ÃƒO EM ROTAS PROTEGIDAS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Todas as rotas CRM requerem o token no header:

GET  /api/crm/panels
GET  /api/crm/panels/:id
GET  /api/crm/cards
GET  /api/crm/cards/:id
GET  /api/crm/agents
GET  /api/crm/agents/:id

Header obrigatÃ³rio:
  Authorization: Bearer ${token}


ğŸ“ EXEMPLO COMPLETO DE FLUXO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. UsuÃ¡rio preenche formulÃ¡rio (telefone ou email)
2. Frontend chama: POST /api/auth/login com { phone: "..." }
3. Backend retorna token JWT
4. Frontend salva token: localStorage.setItem('auth_token', token)
5. Frontend usa token em requisiÃ§Ãµes: 
   fetch('/api/crm/panels', {
     headers: { 'Authorization': `Bearer ${token}` }
   })
6. Se token expirar (401), fazer logout e redirecionar para login


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    FIM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

